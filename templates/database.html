{% extends "base.html" %}
{% block content %}
<div class="card">
  <h3>Registered Fingerprints</h3>

  {% if users %}
  <table id="userTable">
    <tr>
      <th>ID</th>
      <th>Name</th>
      <th>Fingerprint Image</th>
      <th>Actions</th>
    </tr>
    {% for user in users %}
    <tr>
      <td>{{ user.id }}</td>
      <td contenteditable="true" onblur="updateName('{{ user.id }}', this.textContent)">
        {{ user.name }}
      </td>
      <td><img src="{{ url_for('static', filename='placeholder_fingerprint.png') }}" alt="Fingerprint" width="80"></td>
      <td>
        <button onclick="deleteUser('{{ user.id }}')">Delete</button>
      </td>
    </tr>
    {% endfor %}
  </table>
  {% else %}
  <p>No registered fingerprints found.</p>
  {% endif %}
</div>

<script>
async function updateName(id, newName) {
  const res = await fetch("/update_user", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ id, name: newName })
  });
  const result = await res.json();
  if (result.success) {
    alert(`‚úÖ Name for ID ${id} updated to "${newName}"`);
  } else {
    alert(`‚ùå Failed to update name for ID ${id}`);
  }
}

async function deleteUser(id) {
  if (!confirm(`Delete fingerprint ID ${id}?`)) return;
  const res = await fetch("/delete_user", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ id })
  });
  const result = await res.json();
  if (result.success) {
    alert(`üóëÔ∏è Deleted ID ${id}`);
    location.reload();
  } else {
    alert(`‚ùå Failed to delete ID ${id}`);
  }
}
</script>
{% endblock %}
